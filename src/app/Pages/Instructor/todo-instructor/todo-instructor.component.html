<div class="instructor-todo-page">
  <div class="mt-3">
    <div class="Board">
      <div class="header">
        <div class="text">
          <div class="head">
            <div class="icon"><i class="fa-solid fa-list-check"></i></div>
            <div class="name">Task Management</div>
          </div>
          <div class="description">
            <p>Manage and track your tasks easily and efficiently.</p>
            <!-- Debug Info (remove in production) -->
            <small style="color: #6b7280; font-size: 12px;">
              ðŸ“Š Tasks: {{tasks.length}} | Loading: {{isLoading}} | Filter: {{activeFilter}}
            </small>
          </div>
        </div>
      </div>
    </div>

    <div class="searchBoard mb-0 p-3">
      <div class="search-input">
        <input type="text" [(ngModel)]="searchTerm" placeholder="Search tasks...">
        <div class="icon"><i class="fa-solid fa-magnifying-glass"></i></div>
      </div>
      <div class="action-buttons">
        <button (click)="refreshTasks()" class="refresh-btn" [disabled]="isLoading">
          <div class="icon">
            <i class="fa-solid fa-refresh" [class.fa-spin]="isLoading"></i>
          </div>
          <span>Refresh</span>
        </button>
        <button (click)="openAddTaskPopup()">
          <div class="icon">
            <i class="fa-solid fa-plus"></i>
          </div>
          <span>Add New Task</span>
        </button>
      </div>
    </div>

    <div class="row mt-3">
      <div class="col-lg-12">
        <div class="todo-card">
          <div class="controls-section pt-3">
            <div class="filter-tabs">
              <button class="tab-btn" 
                      [class.active]="activeFilter === 'all'"
                      (click)="setFilter('all')">
                <i class="fa-solid fa-list"></i>
                All Tasks
              </button>
              <button class="tab-btn"
                      [class.active]="activeFilter === 'work'"
                      (click)="setFilter('work')">
                <i class="fa-solid fa-briefcase"></i>
                Work
              </button>
              <button class="tab-btn"
                      [class.active]="activeFilter === 'personal'"
                      (click)="setFilter('personal')">
                <i class="fa-solid fa-user"></i>
                Personal
              </button>
              <button class="tab-btn"
                      [class.active]="activeFilter === 'study'"
                      (click)="setFilter('study')">
                <i class="fa-solid fa-book"></i>
                Study
              </button>
              <button class="tab-btn"
                      [class.active]="activeFilter === 'meeting'"
                      (click)="setFilter('meeting')">
                <i class="fa-solid fa-users"></i>
                Meeting
              </button>
              <button class="tab-btn"
                      [class.active]="activeFilter === 'other'"
                      (click)="setFilter('other')">
                <i class="fa-solid fa-tasks"></i>
                Other
              </button>
            </div>
          </div>

          <div class="task-list">
            <!-- Loading State -->
            <div class="loading-state" *ngIf="isLoading">
              <div class="loading-content">
                <i class="fas fa-spinner fa-spin"></i>
                <p>Loading tasks...</p>
              </div>
            </div>

            <!-- Tasks List -->
            <div class="task-item"
                 *ngFor="let task of getFilteredTasks(); trackBy: trackByTaskId"
                 [style.display]="isLoading ? 'none' : 'flex'">
              <div class="task-content">
                <div class="task-checkbox">
                  <input type="checkbox"
                         [id]="'task-' + task.id"
                         [checked]="task.completed"
                         (change)="toggleTaskCompletion(task)"
                         class="form-check-input">
                  <label [for]="'task-' + task.id" class="checkbox-label"></label>
                </div>

                <div class="task-details" [class.completed]="task.completed">
                  <h4 class="task-title">{{ task.name }}</h4>
                  <p class="task-description" *ngIf="task.description">{{ task.description }}</p>
                  
                  <div class="task-meta">
                    <span class="task-type"
                          [class]="'type-' + task.type"
                          [style.color]="getTaskTypeColor(task.type)"
                          [style.background-color]="getTaskTypeBackgroundColor(task.type)"
                          [style.border]="'1px solid ' + getTaskTypeColor(task.type)"
                          [style.padding]="'6px 12px'"
                          [style.border-radius]="'20px'"
                          [style.font-size]="'0.8rem'"
                          [style.font-weight]="'500'">
                      <i [class]="getTaskTypeIcon(task.type)"></i>
                      {{ getTaskTypeLabel(task.type) }}
                    </span>

                    <span class="task-priority"
                          [class]="'priority-' + task.priority"
                          [style.color]="getPriorityColor(task.priority)"
                          [style.background-color]="getPriorityBackgroundColor(task.priority)"
                          [style.border]="'1px solid ' + getPriorityColor(task.priority)"
                          [style.padding]="'8px 14px'"
                          [style.border-radius]="'25px'"
                          [style.font-size]="'0.8rem'"
                          [style.font-weight]="'600'"
                          [style.text-transform]="'uppercase'"
                          [style.letter-spacing]="'0.5px'">
                      <i [class]="getPriorityIcon(task.priority)"></i>
                      {{ getPriorityLabel(task.priority) }}
                    </span>

                    <span class="task-due-date"
                          *ngIf="task.dueDate"
                          [class.overdue]="isOverdue(task.dueDate!) && !task.completed">
                      <i class="fa-solid fa-calendar"></i>
                      {{ formatDueDate(task.dueDate!) }}
                    </span>
                  </div>
                </div>
              </div>
              
              <div class="task-actions">
                <button class="action-btn edit-btn" 
                        title="Edit Task">
                  <i class="fa-solid fa-edit"></i>
                </button>
                <button class="action-btn delete-btn" 
                        (click)="deleteTask(task)"
                        title="Delete Task">
                  <i class="fa-solid fa-trash"></i>
                </button>
              </div>
            </div>

            <!-- Empty State -->
            <div class="empty-state" *ngIf="getFilteredTasks().length === 0 && !isLoading">
              <div class="empty-content">
                <img src="Images/Course/file.png" alt="No tasks" class="empty-image">
                <h4>No tasks found</h4>
                <p>{{ getEmptyStateMessage() }}</p>
                <button (click)="openAddTaskPopup()" class="btn-add-first">
                  <i class="fa-solid fa-plus"></i>
                  Add Your First Task
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
