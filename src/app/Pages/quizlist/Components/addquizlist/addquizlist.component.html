<div class="overlay" *ngIf="showFirstPopup || showSecondPopup"></div>
<div class="ShowPopup" [class.show]="showFirstPopup">
  <app-top-pop [NamePopup]="'Create Quiz'" NameIcon="fa-solid fa-file-circle-plus" bgColor="#24C12B33"
    ColorIcon="#24C12B99" (isVisibleChange)="closePopup()"></app-top-pop>
  <div class="content p-2">
    <div class="courseSelect">
      <app-text-header [title]="'Course'" [bgColor]="'#ec8950'"></app-text-header>

      <div *ngIf="!selectedCourse" class="selectcard mt-3 my-2" (click)="toggleDropdownCourse()">
        <div class="icon">
          <i class="fas fa-book"></i>
        </div>
        <div class="text">
          <p>Click to Add Course</p>
        </div>
      </div>

      <div *ngIf="selectedCourse" class="mt-3">
        <div class="course-card px-2 py-1 position-relative">
          <div class="d-flex align-items-center gap-1">
            <div class="images">
              <img class="rounded-circle" [src]="baseUrl + selectedCourse.photoUrl" height="30" width="30" />
            </div>
            <div class="course-info">
              <h5 class="mb-1 fw-bold">
                {{ selectedCourse.name | splicText : 15 }}
              </h5>
              <p class="date mb-0">
                <i class="fas fa-clock"></i>
                {{ selectedCourse.createdOn | date }}
              </p>
            </div>
          </div>

          <div class="course-details text-end d-flex flex-column align-items-end justify-content-end">
            <p class="price">
              {{ selectedCourse.price }}
              <i class="fas fa-dollar-sign text-success"></i>
            </p>
            <p class="students">
              {{ selectedCourse.enrollmentCount }}
              <i class="fas fa-graduation-cap text-primary"></i>
            </p>
          </div>

          <button class="closeBtn position-absolute" (click)="removeCourse()">
            <i class="fa-solid fa-xmark"></i>
          </button>
        </div>
      </div>
      <div *ngIf="showDropdownCourse" class="dropdown bg-white border rounded p-2 mt-2">
        <div *ngFor="let lead of paginationCoursesResponse.result"
          class="lead-item d-flex justify-content-between align-items-center p-2 border-bottom cursor-pointer"
          (click)="selectCourse(lead)">
          <div class="info_course d-flex gap-2 align-items-center">
            <img class="img-fluid rounded-circle" [src]="baseUrl + lead.photoUrl" width="30" height="30" />
            <div class="info">
              <h5 class="name">{{ lead.name | splicText : 13 }}</h5>
              <p class="price">{{ lead.price }}</p>
            </div>
          </div>
          <div class="deals-btn">With Deals</div>
        </div>
      </div>
    </div>

    <div class="courseSelect mt-2">
      <app-text-header [title]="' Lessons'"></app-text-header>

      <div class="selectcard mt-3 my-2">
        <div class="icon">
          <i class="fas fa-book"></i>
        </div>
        <div class="text">
          <p>Click to Add Lessons</p>
        </div>
      </div>
      <!-- 
        <div *ngIf="selectedCourse" class="mt-3">
          <div class="course-card px-2 py-1 position-relative">
            <div class="d-flex align-items-center gap-1">
              <div class="images">
                <img class=" rounded-circle" [src]="baseUrl + selectedCourse.photoUrl" height="30" width="30">

              </div>
              <div class="course-info">
                <h5 class="mb-1 fw-bold">{{selectedCourse.name |splicText:15}}</h5>
                <p class="date mb-0"><i class="fas fa-clock"></i> {{selectedCourse.createdOn | date}}</p>
              </div>
            </div>

            <div class="course-details text-end d-flex flex-column align-items-end justify-content-end">
              <p class="price"> {{selectedCourse.price}} <i class="fas fa-dollar-sign text-success"></i></p>
              <p class="students">{{selectedCourse.enrollmentCount}} <i class="fas fa-graduation-cap text-primary"></i>
              </p>
            </div>

            <button class="closeBtn position-absolute" (click)="removeCourse()"><i
                class="fa-solid fa-xmark"></i></button>
          </div>
        </div>
        <div *ngIf="showDropdownCourse" class="dropdown bg-white border rounded p-2 mt-2">
          <div *ngFor="let lead of paginationCoursesResponse.result"
            class="lead-item d-flex justify-content-between align-items-center p-2 border-bottom cursor-pointer"
            (click)="selectCourse(lead)">
            <div class="info_course d-flex gap-2 align-items-center">
              <img class="img-fluid rounded-circle" [src]="baseUrl + lead.photoUrl" width="30" height="30">
              <div class="info">
                <h5 class="name">{{ lead.name | splicText :13 }}</h5>
                <p class="price">{{ lead.price }}</p>
              </div>
            </div>
            <div class="deals-btn">With Deals</div>
          </div>
        </div> -->
    </div>
    <div class="courseSelect mt-2">
      <app-text-header [title]="'Discount'" [bgColor]="'#ff6584ab'">
      </app-text-header>
      <div class="checkDicound d-flex gap-2 align-items-center mt-3 justify-content-between">
        <div class="seletDiscound">
          <p-select [options]="discountTypes" optionLabel="label" optionValue="value"
            [(ngModel)]="selectedDiscountType">
          </p-select>
        </div>
        <div class="valuDiscound">
          <input type="number" class="input_Couser" placeholder="Enter Time Value">
          <span class="price">
            {{ selectedDiscountType === 1 ? 'h' : 'm' }} </span>
        </div>
      </div>


    </div>

    <div class="mainSelet courseSelect  mt-2">
      <app-text-header [title]="'Main quiz information'" [bgColor]="'#6662FF'"> </app-text-header>
      <div class="mainContent mt-3">
        <div class="codeCoupon d-flex gap-2 align-items-end mb-2">
          <div class="Course_name flex-grow-1">
            <label for="Course_name">Quiz name</label>
            <input type="text" id="Course_name" placeholder="Enter Quiz name" class="input_Couser ">
          </div>
          <div class="deal-desc-btn" tooltipPosition="top">
            <i class="fa-kit fa-subtitles"></i>
          </div>
        </div>
        <div class="desCourse_name Course_name mt-2  active">
          <label for="Course_description">Description</label>
          <textarea class="input_Couser textarea_course" id="Course_description"></textarea>
        </div>






      </div>

    </div>




  </div>
  <div class="footerCourse bg-white rounded-1">
    <div class="btnsCourse">
      <button (click)="nextPopup()" [disabled]="!selectedCourse">
        <span>Next</span>
      </button>
    </div>
  </div>
</div>

<div class="ShowPopupTwo" [class.show]="showSecondPopup">

  <app-top-pop [NamePopup]="'Form question '" NameIcon="fa-solid fa-text-slash" bgColor="#24C12B33"
    ColorIcon="#24C12B99" (isVisibleChange)="closePopup()"></app-top-pop>

  <div class="contentExam p-2">
    <div class="headerExam">
      <div class="leftExam">
        <div class="examCreate">
          <app-text-header [title]="'Quiz'" [bgColor]="'#6625259C'"> </app-text-header>
          <div class="quiz-info mt-2">
            <div class="quiz-icon">
              <i class="fa-solid fa-file-invoice"></i>
            </div>
            <div class="quiz-details">
              <h5>Quiz one</h5>
              <p class="date mb-0">
                <i class="fas fa-clock"></i>
                Mon, Jan 31, 2025
              </p>
            </div>
          </div>
        </div>

      </div>
      <div class="rigntExam">
        <div class="CourseCreate">
          <app-text-header [title]="'Courses '" [bgColor]="'#6625259C'"> </app-text-header>
          <div class="course-card mt-2" *ngIf="selectedCourse">
            <div class="d-flex align-items-center gap-2">
              <div class="course-image">
                <img class="rounded-circle"
                  [src]="baseUrl + selectedCourse.photoUrl" height="30"
                  width="30" />
              </div>
              <div class="course-info">
                <h5 class="mb-1 fw-bold">
                  {{ selectedCourse.name | splicText : 20 }}
                </h5>
                <p class="date mb-0">
                  <i class="fas fa-clock"></i>
                  Mon, Jan 31, 2025
                </p>
              </div>
            </div>

            <div class="course-stats">
              <div class="stat-item">
                <span class="stat-value">{{ selectedCourse.price}}</span>
                <i class="fas fa-dollar-sign text-success"></i>
              </div>
              <div class="stat-item">
                <span class="stat-value">{{ selectedCourse.enrollmentCount}}</span>
                <i class="fas fa-graduation-cap text-primary"></i>
              </div>
     
            </div>
          </div>
        </div>

      </div>
    </div>

    <!-- Quiz Sections Display -->
    <div class="quiz-sections-container">

      <!-- Existing Sections -->
      <div *ngFor="let section of sections; let i = index" class="quiz-section-card" [class.active-section]="section.isActive">
        <div class="section-header" (click)="toggleSection(i)">
          <div class="section-left">
            <div class="section-icon">
              <i class="fas fa-grip-vertical"></i>
            </div>
            <div class="section-info">
              <h6 class="section-name">
                {{section.name}}
                <span class="active-badge" *ngIf="section.isActive">Active</span>
              </h6>
            </div>
          </div>
          <div class="section-actions">
            <button class="action-btn activate-btn" (click)="setActiveSection(i, $event)" title="Set as Active Section" *ngIf="!section.isActive">
              <i class="fas fa-target"></i>
            </button>
            <button class="action-btn copy-btn" title="Copy Section">
              <i class="fas fa-copy"></i>
            </button>
            <button class="action-btn delete-btn" (click)="removeSection(i, $event)" title="Delete Section">
              <i class="fas fa-trash"></i>
            </button>
          </div>
        </div>

        <div class="section-content" [class.collapsed]="section.collapsed">
          <div class="questions-list">
            <div *ngFor="let question of section.questions; let qi = index" class="question-item">
              <div class="question-content">
                <div class="question-text">{{question.text}}</div>
                <div class="question-options" *ngIf="section.type === 0">
                  <div class="option" [class.selected]="question.trueAndFalse?.answer === true">
                    <span class="option-icon true-icon">
                      <i class="fas fa-check"></i>
                    </span>
                    <span>True</span>
                  </div>
                  <div class="option" [class.selected]="question.trueAndFalse?.answer === false">
                    <span class="option-icon false-icon">
                      <i class="fas fa-times"></i>
                    </span>
                    <span>False</span>
                  </div>
                </div>
              </div>
              <div class="question-actions">
                <select class="difficulty-select">
                  <option value="easy">Easy</option>
                  <option value="medium">Medium</option>
                  <option value="hard">Hard</option>
                </select>
                <button class="action-btn copy-btn">
                  <i class="fas fa-copy"></i>
                </button>
                <button class="action-btn delete-btn">
                  <i class="fas fa-trash"></i>
                </button>
                <button class="action-btn more-btn">
                  <i class="fas fa-ellipsis-h"></i>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Add New Section Button -->
      <div class="add-section-btn" *ngIf="sections.length > 0">
        <button class="btn-new-section" (click)="startNewSection()">
          <i class="fas fa-plus me-2"></i>
          New section
        </button>
      </div>

    </div>

    <!-- Section Creation Form -->
    <div class="section-creation-form" *ngIf="showSectionForm">
      <div class="form-card">
        <div class="form-header">
          <h6>Create New Section</h6>
          <button class="close-btn" (click)="cancelSectionCreation()">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <div class="form-body">
          <input
            type="text"
            class="form-control"
            [(ngModel)]="currentSectionName"
            placeholder="Enter section name..."
            maxlength="100">
          <div class="form-actions">
            <button class="btn-cancel" (click)="cancelSectionCreation()">Cancel</button>
            <button class="btn-create" (click)="createNewSection()" [disabled]="!currentSectionName">
              Create Section
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Show section form initially if no sections exist -->
    <div *ngIf="sections.length === 0 && !showSectionForm" class="initial-state">
      <div class="welcome-message text-center p-4">
        <i class="fas fa-folder-plus fa-3x text-primary mb-3"></i>
        <h5 class="text-primary">Create Your First Section</h5>
        <p class="text-muted">Start by creating a section to organize your questions</p>
        <button class="btn btn-primary" (click)="startNewSection()">
          <i class="fas fa-plus me-2"></i>
          Create Section
        </button>
      </div>
    </div>

    <!-- Questions Interface - Only show when section form is shown or sections exist -->
    <div class="questions-interface" *ngIf="showSectionForm || sections.length > 0">
      <div class="HeaderQuiz mt-2 p-2">
            <div class="tabs d-flex gap-2 align-content-center">
            <button class="btnTab" (click)="changeValue(0)" [class.btnActive]="value == 0">
              True and false
              <span class="badge-count" *ngIf="trueFalseQuestions.length > 0">{{trueFalseQuestions.length}}</span>
            </button>
            <button class="btnTab" (click)="changeValue(1)" [class.btnActive]="value == 1">
              Short answer
              <span class="badge-count" *ngIf="shortAnswerQuestions.length > 0">{{shortAnswerQuestions.length}}</span>
            </button>
            <button class="btnTab" (click)="changeValue(2)" [class.btnActive]="value == 2">
              Multiple choice
              <span class="badge-count" *ngIf="multipleChoiceQuestions.length > 0">{{multipleChoiceQuestions.length}}</span>
            </button>
          </div>
          <div class="action d-flex gap-2 align-items-center">
            <div class="view-toggle">
              <i class="fas fa-eye text-success"></i>
            </div>
            <button class="btn-new-section" (click)="addQuestion()" [disabled]="!showSectionForm">
              <i class="fas fa-plus"></i>
              Add Question
            </button>
          </div>
      </div>

      <div class="questions-container">
          <ng-container *ngIf="value == 0">
            <div *ngIf="trueFalseQuestions.length === 0" class="empty-state">
              <div class="empty-icon">
                <i class="fas fa-question-circle"></i>
              </div>
              <h3>No questions yet</h3>
              <p>Add questions, then click "Create Section" to save them.</p>
            </div>
            <div *ngFor="let question of trueFalseQuestions.controls; let i = index" class="question-wrapper">
              <app-true-false
                [formGroup]="$any(question)"
                [questionIndex]="i"
                (removeQuestion)="removeTrueFalseQuestion(i)">
              </app-true-false>
            </div>
          </ng-container>

          <ng-container *ngIf="value == 1">
            <div *ngIf="shortAnswerQuestions.length === 0" class="empty-state">
              <div class="empty-icon">
                <i class="fas fa-edit"></i>
              </div>
              <h3>No questions yet</h3>
              <p>Add questions, then click "Create Section" to save them.</p>
            </div>
            <div *ngFor="let question of shortAnswerQuestions.controls; let i = index" class="question-wrapper">
              <app-short-answer
                [formGroup]="$any(question)"
                [questionIndex]="i"
                (removeQuestion)="removeShortAnswerQuestion(i)">
              </app-short-answer>
            </div>
          </ng-container>

          <ng-container *ngIf="value == 2">
            <div *ngIf="multipleChoiceQuestions.length === 0" class="empty-state">
              <div class="empty-icon">
                <i class="fas fa-list"></i>
              </div>
              <h3>No questions yet</h3>
              <p>Add questions, then click "Create Section" to save them.</p>
            </div>
            <div *ngFor="let question of multipleChoiceQuestions.controls; let i = index" class="question-wrapper">
              <app-multiple-choice
                [formGroup]="$any(question)"
                [questionIndex]="i"
                (removeQuestion)="removeMultipleChoiceQuestion(i)">
              </app-multiple-choice>
            </div>
          </ng-container>
        </div>
    </div>



  </div>

  <div class="footerCourse bg-white rounded-1">
    <div class="btnsCourse d-flex justify-content-between">
      <button class="btn-back" (click)="goBack()">
        <i class="fas fa-arrow-left me-2"></i>
        <span>Back</span>
      </button>
      <div class="save-buttons d-flex gap-2">
        <button
          class="btn-save-all"
          (click)="saveAllSections()"
          [disabled]="sections.length === 0">
          <i class="fas fa-save me-2"></i>
          <span>Save Quiz ({{sections.length}} sections)</span>
        </button>
      </div>
    </div>
  </div>
</div>