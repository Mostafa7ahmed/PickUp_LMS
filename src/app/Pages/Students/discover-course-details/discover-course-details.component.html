<!-- Loading State -->
<div class="loading-container" *ngIf="isLoading">
  <div class="loading-content">
    <div class="spinner">
      <i class="fas fa-spinner fa-spin"></i>
    </div>
    <h3>Loading Course Details...</h3>
    <p>Please wait while we fetch the course information</p>
  </div>
</div>

<!-- Unified Course Details Container -->
<div class="course-details-container" *ngIf="!isLoading && courseDetailsdata?.success">
  <!-- Left View - Course Information & Enrollment -->
  <div class="leftView">
    <div class="course-profile">
      <!-- Course Image with Video Play -->
      <div class="course-image-container">
        <img 
          [src]="courseDetailsdata.result.photo ? baseUrl + courseDetailsdata.result.photo : 'Images/Course/Image+Background.png'" 
          [alt]="courseDetailsdata.result.name || 'Course Image'"
          class="course-image">
        
        <!-- Video Play Overlay -->
        <div class="video-play-overlay" *ngIf="courseDetailsdata.result.introductionVideo" (click)="playIntroVideo()">
          <div class="play-button">
            <i class="fas fa-play"></i>
          </div>
        </div>
      </div>

      <!-- Course Basic Info -->
      <div class="course-info">
        <h2 class="course-title">{{courseDetailsdata.result.name || 'Course Title'}}</h2>
        <p class="course-subtitle">Discover and master new skills with this comprehensive course</p>
        
        <!-- Instructor Info -->
        <div class="instructor-info">
          <img 
            [src]="courseDetailsdata.result.instructor.photo ? baseUrl + courseDetailsdata.result.instructor.photo : 'Images/Icons/Student.svg'" 
            class="instructor-avatar" 
            alt="instructor">
          <div class="instructor-details">
            <h4>{{courseDetailsdata.result.instructor.name}}</h4>
            <p>Professional Instructor</p>
            <div class="instructor-rating">
              <i class="fas fa-star"></i>
              <span>{{courseDetailsdata.result.instructor.rating}}/5 instructor rating</span>
            </div>
          </div>
        </div>

        <!-- Enrollment Button -->
        <button class="enroll-btn" (click)="openEnrollmentPopup()">
          <i class="fas fa-graduation-cap"></i>
          <span>Enroll in This Course</span>
        </button>
      </div>
    </div>
  </div>

  <!-- Middle View - Main Content -->
  <div class="middleView">
    <!-- Course Statistics Header -->
    <div class="course-stats-header">
      <div class="stat-item">
        <div class="stat-icon">
          <i class="fas fa-star"></i>
        </div>
        <div class="stat-content">
          <p class="stat-label">Course Rating</p>
          <p class="stat-value">{{courseDetailsdata.result.rating || 'N/A'}}</p>
        </div>
      </div>
      
      <div class="stat-item">
        <div class="stat-icon">
          <i class="fas fa-users"></i>
        </div>
        <div class="stat-content">
          <p class="stat-label">Students Enrolled</p>
          <p class="stat-value">{{courseDetailsdata.result.enrolledCount || 0}}</p>
        </div>
      </div>
      
      <div class="stat-item">
        <div class="stat-icon">
          <i class="fas fa-clock"></i>
        </div>
        <div class="stat-content">
          <p class="stat-label">Last Updated</p>
          <p class="stat-value">{{courseDetailsdata.result.updatedOn | date:'MMM yyyy' || 'Recently'}}</p>
        </div>
      </div>
    </div>

    <!-- Tabbed Content -->
    <div class="tabs-container">
      <p-tabs [(value)]="value">
        <p-tablist>
          <p-tab [value]="0">
            <div class="tab-header">
              <i class="fas fa-info-circle"></i>
              <span>Overview</span>
            </div>
          </p-tab>
          <p-tab [value]="1">
            <div class="tab-header">
              <i class="fas fa-graduation-cap"></i>
              <span>What You'll Learn</span>
            </div>
          </p-tab>
          <p-tab [value]="2">
            <div class="tab-header">
              <i class="fas fa-user-tie"></i>
              <span>Instructor</span>
            </div>
          </p-tab>
          <p-tab [value]="3">
            <div class="tab-header">
              <i class="fas fa-star"></i>
              <span>Reviews</span>
            </div>
          </p-tab>
        </p-tablist>

        <p-tabpanels>
          <!-- Overview Tab -->
          <p-tabpanel [value]="0">
            <div class="tab-content">
              <div class="content-section">
                <app-text-header [title]="'Course Overview'" [bgColor]="'#3b82f6'"></app-text-header>
                <div class="course-description">
                  <p>{{courseDetailsdata.result.description || 'This comprehensive course is designed to provide you with in-depth knowledge and practical skills. Learn from industry experts and gain hands-on experience that will advance your career.'}}</p>
                </div>
                
                <div class="course-highlights">
                  <h4>Course Highlights:</h4>
                  <ul>
                    <li><i class="fas fa-check-circle"></i> Expert-led instruction</li>
                    <li><i class="fas fa-check-circle"></i> Practical, hands-on learning</li>
                    <li><i class="fas fa-check-circle"></i> Industry-relevant curriculum</li>
                    <li><i class="fas fa-check-circle"></i> Flexible learning schedule</li>
                    <li><i class="fas fa-check-circle"></i> Certificate upon completion</li>
                  </ul>
                </div>
              </div>
            </div>
          </p-tabpanel>

          <!-- What You'll Learn Tab -->
          <p-tabpanel [value]="1">
            <div class="tab-content">
              <div class="content-section">
                <app-text-header [title]="'Learning Outcomes'" [bgColor]="'#10b981'"></app-text-header>
                <div class="learning-outcomes">
                  <p>By the end of this course, you will be able to:</p>
                  <ul class="outcomes-list">
                    <li><i class="fas fa-lightbulb"></i> Master the fundamental concepts and principles</li>
                    <li><i class="fas fa-lightbulb"></i> Apply theoretical knowledge to practical scenarios</li>
                    <li><i class="fas fa-lightbulb"></i> Develop problem-solving and critical thinking skills</li>
                    <li><i class="fas fa-lightbulb"></i> Create professional-quality projects and solutions</li>
                    <li><i class="fas fa-lightbulb"></i> Understand industry best practices and standards</li>
                  </ul>
                </div>
                
                <div class="curriculum-preview">
                  <h4>Course Structure Preview:</h4>
                  <div class="curriculum-note">
                    <i class="fas fa-info-circle"></i>
                    <p>Complete course curriculum and materials will be available after enrollment. This course is taught by {{courseDetailsdata.result.instructor.name}} with a {{courseDetailsdata.result.instructor.rating}}/5 instructor rating.</p>
                  </div>
                </div>
              </div>
            </div>
          </p-tabpanel>

          <!-- Instructor Tab -->
          <p-tabpanel [value]="2">
            <div class="tab-content">
              <div class="content-section">
                <app-text-header [title]="'Meet Your Instructor'" [bgColor]="'#f59e0b'"></app-text-header>
                <div class="instructor-details-full">
                  <div class="instructor-card-detailed">
                    <div class="instructor-header-detailed">
                      <img 
                        [src]="courseDetailsdata.result.instructor.photo ? baseUrl + courseDetailsdata.result.instructor.photo : 'Images/Icons/Student.svg'" 
                        [alt]="courseDetailsdata.result.instructor.name" 
                        class="instructor-avatar-large">
                      <div class="instructor-info-detailed">
                        <h3>{{courseDetailsdata.result.instructor.name}}</h3>
                        <p class="instructor-title-detailed">Professional Instructor</p>
                        <div class="instructor-rating-detailed">
                          <i class="fas fa-star"></i>
                          <span>{{courseDetailsdata.result.instructor.rating}}/5 instructor rating</span>
                        </div>
                      </div>
                    </div>

                                        <div class="instructor-bio">
                      <h4>About {{courseDetailsdata.result.instructor.name}}</h4>
                      <p>{{courseDetailsdata.result.instructor.bio || 'Professional instructor dedicated to providing high-quality education and helping students achieve their learning goals. With expertise in the field and a commitment to student success.'}}</p>
                      
                      <div class="instructor-expertise" *ngIf="courseDetailsdata.result.rating && courseDetailsdata.result.rating >= 4">
                        <h5>Course Quality Indicators:</h5>
                        <div class="expertise-tags">
                          <span class="tag">High Rating ({{courseDetailsdata.result.rating}}/5)</span>
                          <span class="tag">{{courseDetailsdata.result.enrolledCount | number}} Students</span>
                                                     <span class="tag" *ngIf="courseDetailsdata.result.ratings?.length">{{courseDetailsdata.result.ratings.length}} Reviews</span>
                          <span class="tag" *ngIf="courseDetailsdata.result.introductionVideo">Video Content</span>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </p-tabpanel>

          <!-- Reviews Tab -->
          <p-tabpanel [value]="3">
            <div class="tab-content">
              <div class="content-section">
                <app-text-header [title]="'Student Reviews'" [bgColor]="'#8b5cf6'"></app-text-header>
                <div class="reviews-section">
                  <div class="reviews-overview">
                    <div class="overall-rating">
                                             <div class="rating-score">
                         <span class="score">{{courseDetailsdata.result.rating || 'N/A'}}</span>
                         <div class="stars">
                           <i class="fas fa-star" *ngFor="let star of getStars(courseDetailsdata.result.rating || 0)"></i>
                         </div>
                       </div>
                                             <p class="rating-text">Based on {{courseDetailsdata.result.ratings.length || 0}} reviews</p>
                    </div>
                  </div>
                  
                                     <div class="reviews-list" *ngIf="courseDetailsdata.result.ratings && courseDetailsdata.result.ratings.length > 0; else noReviews">
                     <div class="review-item" *ngFor="let review of courseDetailsdata.result.ratings">
                      <div class="review-header">
                        <div class="reviewer-info">
                          <div class="reviewer-avatar">
                            <i class="fas fa-user"></i>
                          </div>
                          <div class="reviewer-details">
                            <span class="reviewer-name">Student Review</span>
                            <div class="review-rating">
                              <i class="fas fa-star" *ngFor="let star of getStars(review.value)"></i>
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="review-content">
                        <p>{{review.note || 'Great course with excellent content and instruction. Highly recommended for anyone looking to learn this subject.'}}</p>
                      </div>
                    </div>
                  </div>
                  
                  <ng-template #noReviews>
                    <div class="no-reviews">
                      <i class="fas fa-star-o"></i>
                      <h4>No Reviews Yet</h4>
                      <p>Be the first to enroll and leave a review for this course!</p>
                    </div>
                  </ng-template>
                </div>
              </div>
            </div>
          </p-tabpanel>
        </p-tabpanels>
      </p-tabs>
    </div>
  </div>

  <!-- Right View - Video Section -->
  <div class="rightView">
    <div class="video-section">
      <app-text-header [title]="'Course Preview'" [bgColor]="'#ec4899'"></app-text-header>
      <div class="video-container" *ngIf="courseDetailsdata.result.introductionVideo; else noVideo">
        <video 
          #videoPlayer 
          class="intro-video" 
          controls 
          *ngIf="showVideo">
          <source [src]="safeVideoUrl" type="video/mp4">
          Your browser does not support the video tag.
        </video>
        <div class="video-placeholder" *ngIf="!showVideo" (click)="playIntroVideo()">
          <img 
            [src]="courseDetailsdata.result.photo ? baseUrl + courseDetailsdata.result.photo : 'Images/Course/Image+Background.png'" 
            [alt]="courseDetailsdata.result.name"
            class="video-thumbnail">
          <div class="play-overlay">
            <div class="play-btn">
              <i class="fas fa-play"></i>
            </div>
            <p>Watch Course Introduction</p>
          </div>
        </div>
      </div>
      
      <ng-template #noVideo>
        <div class="no-video">
          <i class="fas fa-video"></i>
          <h4>No Preview Available</h4>
          <p>Introduction video will be available after enrollment.</p>
        </div>
      </ng-template>
    </div>
  </div>
</div>

<!-- Enrollment Popup -->
<app-enrollment-popup
  *ngIf="selectedCourseForEnrollment && showEnrollmentPopup"
  [course]="selectedCourseForEnrollment!"
  [isVisible]="showEnrollmentPopup"
  (closePopup)="onCloseEnrollmentPopup()"
  (enrollmentComplete)="onEnrollmentComplete($event)"
></app-enrollment-popup>

<!-- Success Popup -->
<app-success-popup
  *ngIf="showSuccessPopup && successData"
  [successData]="successData"
  [isVisible]="showSuccessPopup"
  (onClose)="onSuccessClose()"
></app-success-popup> 