<div class="courses py-2">
<div class="topCourses ">

    <div class="footerBanner d-flex justify-content-between align-items-end ">
      <div class="leftFooter d-flex align-items-center gap-3">
        <div class="iconHeader">
          <i class="fa-solid fa-chalkboard-user"></i>
        </div>
        <div class="titleHeader">
          <h3 class="m-0">{{"course.mainContent.CoursesList" | translate }}</h3>

          <app-customslectwithicon [items]="topicsList" [isLoadTopic]="true" [selectedItem]="selectedValue"
            (selectionChange)="selectOption($event)">
          </app-customslectwithicon>


        </div>
      </div>

      <div class="rightFooter d-flex gap-3">

        <div class="endBannerRight">
          <div class="leftbanner d-flex align-items-center gap-2 " [class.activeHeader]="valueheader == 0">
            <p-button (onClick)="changeTab(0)" rounded="true" styleClass="tabHeader">
              <div class="icon">
                <i class="fa-solid fa-table"></i>
              </div>
              <span>{{"course.mainContent.table" | translate }}</span>
            </p-button>
          </div>
          <span class="line"></span>
          <div class="rightbanner d-flex align-items-center pos" [class.activeHeader]="valueheader == 1">

            <p-button (onClick)="changeTab(1)" rounded="true" styleClass="tabHeader">
              <div class="icon">
                <i class="fa-light fa-objects-align-top"></i>
              </div>
              <span>{{"course.mainContent.kanban" | translate }}</span>
            </p-button>

          </div>
          <button class="openCard" (click)="toggShowInfo()" [class.rotatearrow]="showInfo">
            <i class="fa-solid fa-caret-down"></i>
          </button>
        </div>

      </div>
    </div>
  </div>


  <app-widget-courses [showInfo]="showInfo"></app-widget-courses>


  <p-tabs [value]="valueheader" class="m-0">
    <p-tabpanels class="m-0">
      <p-tabpanel [value]="0">
        <div class="showDataCourses ">
          <div class="headerTabs">
            <div class="tab tab1" [class.active]="valueTable == 0">
              <p-button (onClick)="changeInnerTab(0)" rounded="true" styleClass="tabtext">
                {{"course.mainContent.allCourses " | translate }} <span>+99</span>
              </p-button>
            </div>
            <div class="tab tab2" [class.active]="valueTable == 1">
              <p-button (onClick)="changeInnerTab(1)" rounded="true" styleClass="tabtext">
                {{"course.mainContent.freeCourses " | translate }} <span>+99</span>
              </p-button>
            </div>
            <div class="tab tab3" [class.active]="valueTable == 2">
              <p-button (onClick)="changeInnerTab(2)" rounded="true" styleClass="tabtext">
                {{"course.mainContent.soildCourses " | translate }} <span>+99</span>
              </p-button>
            </div>
          </div>
          <!-- Search Results Info -->
          <div class="search-results-info" *ngIf="searchTerm || hasActiveFilters()">
            <div class="results-count">
              <i class="fas fa-search"></i>
              <span>{{paginationCoursesResponse.totalCount || 0}} courses found</span>
              <span *ngIf="searchTerm">for "{{searchTerm}}"</span>
            </div>
            <button class="btn-clear-search-small" (click)="clearAllSearchFilters()">
              <i class="fas fa-times"></i>
              Clear Search
            </button>
          </div>

          <div class="search-container p-3 px-0 d-flex justify-content-between">
            <div class="search-container-right d-flex gap-3">
              <div class="inputSearch">

                <input type="text" [(ngModel)]="searchTerm" (keyup)="onSearchChange($event)" [placeholder]="'course.mainContent.SearchPlaceholder' | translate">
              </div>
              <div class="advanced-filter-container"
                   [class.active]="hasActiveFilters()"
                   (click)="openAdvancedSearch()">
                <svg id="advanced-filter-svg" class="my-svg" xmlns="http://www.w3.org/2000/svg" width="20" height="20"
                  viewBox="0 0 20 20">
                  <path _ngcontent-ng-c2580197127="" id="advanced-filter-svg-path1"
                    d="M9.11668 18.875C8.71668 18.875 8.32501 18.775 7.95834 18.575C7.22501 18.1667 6.78334 17.425 6.78334 16.5917V12.175C6.78334 11.7583 6.50834 11.1333 6.25001 10.8167L3.13334 7.51667C2.60834 6.99167 2.20834 6.09167 2.20834 5.41667V3.5C2.20834 2.16667 3.21668 1.125 4.50001 1.125H15.5C16.7667 1.125 17.7917 2.15 17.7917 3.41667V5.25C17.7917 6.125 17.2667 7.11667 16.775 7.60833L13.1667 10.8C12.8167 11.0917 12.5417 11.7333 12.5417 12.25V15.8333C12.5417 16.575 12.075 17.4333 11.4917 17.7833L10.3417 18.525C9.96668 18.7583 9.54168 18.875 9.11668 18.875ZM4.50001 2.375C3.91668 2.375 3.45834 2.86667 3.45834 3.5V5.41667C3.45834 5.725 3.70834 6.325 4.02501 6.64167L7.20001 9.98333C7.62501 10.5083 8.04168 11.3833 8.04168 12.1667V16.5833C8.04168 17.125 8.41668 17.3917 8.57501 17.475C8.92501 17.6667 9.35001 17.6667 9.67501 17.4667L10.8333 16.725C11.0667 16.5833 11.3 16.1333 11.3 15.8333V12.25C11.3 11.3583 11.7333 10.375 12.3583 9.85L15.925 6.69167C16.2083 6.40833 16.55 5.73333 16.55 5.24167V3.41667C16.55 2.84167 16.0833 2.375 15.5083 2.375H4.50001Z"
                    fill="#909EAF"></path>
                  <path _ngcontent-ng-c2580197127="" id="advanced-filter-svg-path2"
                    d="M5 8.95833C4.88333 8.95833 4.775 8.925 4.66666 8.86666C4.375 8.68333 4.28333 8.29166 4.46666 8L8.575 1.41666C8.75833 1.125 9.14166 1.03333 9.43333 1.21666C9.725 1.4 9.81666 1.78333 9.63333 2.075L5.525 8.65833C5.40833 8.85 5.20833 8.95833 5 8.95833Z"
                    fill="#909EAF"></path>
                </svg>
                <div class="filter-badge" *ngIf="getActiveFiltersCount() > 0">
                  {{getActiveFiltersCount()}}
                </div>
              </div>

              <div class="CreationDate position-relative"
                [ngClass]="{'CreationDateFouce': rangeDates && rangeDates[0]}">
                <div class="icon" id="stage-drop-down-icon-0">
                  <i class="icon-grey fa-kit fa-calendar" id="stage-drop-down-icon-i-0"></i>
                </div>
                <p class="m-0">{{"course.mainContent.CreationDate" | translate }}</p>
                <p-datepicker class="icon-only position-relative" [(ngModel)]="rangeDates" selectionMode="range"
                  [readonlyInput]="true" dateFormat="dd-mm-yyyy" (onSelect)="convertDateRange()">
                </p-datepicker>
                <div class="clear" *ngIf="rangeDates?.length" (click)="clearDateRange()">
                  <i class="fa fa-close close-icon" aria-hidden="true"></i>
                </div>

              </div>

              <div class="CreationDate dropdown">
                <div class="stages d-flex align-items-center gap-1 w-100" (click)="toggleDropdown()">
                  <div class="icon">
                    <i class="icon-grey fa-kit fa-profile-circle"></i>
                  </div>
                  <p class="m-0">{{"course.mainContent.Stage" | translate }} </p>

                </div>
                <div class="clear" *ngIf="iselectedStage" (click)="clearDateRange()">
                  <i class="fa fa-close close-icon" aria-hidden="true"></i>
                </div>
                <div #dropdownContainer class="dropdown-content" *ngIf="dropdownVisible">
                  <div *ngFor="let status of selectedValue.stages" class="dropdown-item" (click)="selectStatus(status)">

                    <div class="progressBar" [style.border-color]="status.color"></div>


                    <span class="selected-value">{{ status.name }}</span>
                  </div>
                </div>
              </div>



            </div>
            <div class="search-container-left">
              <div class="addCourse" (click)="openPopup()">
                <button class="btn-add"><i class="fa fa-plus-square" aria-hidden="true"></i> {{"course.mainContent.addCourse" | translate }}</button>
              </div>
            </div>


          </div>

          <p-tabs [value]="valueTable">
            <p-tabpanels>
              <p-tabpanel [value]="0">
                <app-table-courses (fetchCoursesEvent)="fetchCourses($event,selectedTopicId)"
                  [paginationCoursesResponse]="paginationCoursesResponse">
                </app-table-courses>
              </p-tabpanel>
              <p-tabpanel [value]="1">
                <app-table-courses [paginationCoursesResponse]="paginationCoursesResponse"
                  (fetchCoursesEvent)="fetchCourses($event,selectedTopicId ,valueTable )"></app-table-courses>
              </p-tabpanel>
              <p-tabpanel [value]="2">
                <app-table-courses [paginationCoursesResponse]="paginationCoursesResponse"
                  (fetchCoursesEvent)="fetchCourses($event,selectedTopicId , valueTable)"></app-table-courses>
              </p-tabpanel>
            </p-tabpanels>
          </p-tabs>
        </div>
      </p-tabpanel>

      <p-tabpanel [value]="1">
        <div class=" Kanbans bg-white ">

          <div class="headerKanban">

            <div class="inputSearch">
              <input type="text" [placeholder]="'course.mainContent.SearchPlaceholder' | translate">

            </div>

            <div class="addCourse" (click)="openPopup()">
              <button class="btn-add"><i class="fa fa-plus-square" aria-hidden="true"></i> {{"course.mainContent.addCourse" | translate }}</button>
            </div>


          </div>

          <div class="KanbansCard  d-flex gap-3" #scrollKanpan>
            @if(kanbanResponse.success){
            @for (stageColumn of kanbanResponse.result.topic.stages; track stageColumn.stageId) {
            <app-cardkanban-stage [stageColumn]="stageColumn" [allStages]="kanbanResponse.result.topic.stages"
              (moveCourse)="handleMoveCourse($event)"></app-cardkanban-stage>
            }
            }






          </div>


          <div class="leftScroll" [class.d-none]="!showLeftScroll" (mouseenter)="scrollTable('left')"
            (mouseleave)="stopScroll()">
            <i class="fa-solid fa-chevron-left"></i>
          </div>

          <div class="rightScroll" [class.d-none]="!showRightScroll" (mouseenter)="scrollTable('right')"
            (mouseleave)="stopScroll()">
            <i class="fa-solid fa-chevron-right"></i>
          </div>





        </div>
      </p-tabpanel>
    </p-tabpanels>
  </p-tabs>



  <!-- <app-tablereused [paginationResponse]="paginationCoursesResponse" [headers]=headers [records]="tableRecords" (fetchRemainingDataEvent)="fetchCourses($event,selectedTopicId ,valueTable )"></app-tablereused> -->

  <!-- Advanced Search Popup -->
  <div class="advanced-search-overlay" *ngIf="showAdvancedSearch" (click)="closeAdvancedSearch()">
    <div class="advanced-search-popup" (click)="$event.stopPropagation()">
      <div class="popup-header">
        <h3>
          <i class="fas fa-filter"></i>
          Advanced Filters
        </h3>
        <button class="close-btn" (click)="closeAdvancedSearch()">
          <i class="fas fa-times"></i>
        </button>
      </div>

      <div class="popup-body">
        <!-- Search Input -->
        <div class="search-section">
          <label>Search Term</label>
          <div class="search-input-container">
            <i class="fas fa-search"></i>
            <input type="text"
                   [(ngModel)]="advancedSearchFilters.searchTerm"
                   placeholder="Search courses by name, description..."
                   class="search-input">
            <button class="clear-btn"
                    *ngIf="advancedSearchFilters.searchTerm"
                    (click)="advancedSearchFilters.searchTerm = ''">
              <i class="fas fa-times"></i>
            </button>
          </div>
        </div>

        <!-- Difficulty Level -->
        <div class="filter-section">
          <div class="section-header">
            <div class="section-indicator difficulty-indicator"></div>
            <label class="section-label">Difficulty Level</label>
          </div>
          <div class="difficulty-buttons">
            <button class="difficulty-btn easy"
                    [class.active]="advancedSearchFilters.courseType === '0'"
                    (click)="selectDifficulty('easy')">
              <div class="difficulty-bars">
                <div class="bar active"></div>
                <div class="bar"></div>
                <div class="bar"></div>
              </div>
              <span>EASY</span>
            </button>
            <button class="difficulty-btn medium"
                    [class.active]="advancedSearchFilters.courseType === '1'"
                    (click)="selectDifficulty('medium')">
              <div class="difficulty-bars">
                <div class="bar active"></div>
                <div class="bar active"></div>
                <div class="bar"></div>
              </div>
              <span>MEDIUM</span>
            </button>
            <button class="difficulty-btn hard"
                    [class.active]="advancedSearchFilters.courseType === '2'"
                    (click)="selectDifficulty('hard')">
              <div class="difficulty-bars">
                <div class="bar active"></div>
                <div class="bar active"></div>
                <div class="bar active"></div>
              </div>
              <span>HARD</span>
            </button>
          </div>
        </div>

        <!-- Filters Grid -->
        <div class="filters-grid">
          <!-- Topic Filter -->
          <div class="filter-group">
            <label>Topic</label>
            <select [(ngModel)]="advancedSearchFilters.topicId" class="filter-select">
              <option value="">All Topics</option>
              <option *ngFor="let topic of topicsList" [value]="topic.id">
                {{topic.name}}
              </option>
            </select>
          </div>

          <!-- Stage Filter -->
          <div class="filter-group">
            <label>Stage</label>
            <select [(ngModel)]="advancedSearchFilters.stageId"
                    class="filter-select"
                    [disabled]="!advancedSearchFilters.topicId">
              <option value="">All Stages</option>
              <option *ngFor="let stage of getStagesForSelectedTopic()" [value]="stage.id">
                {{stage.name}}
              </option>
            </select>
          </div>
        </div>

        <!-- Number of Questions -->
        <div class="filter-section">
          <div class="section-header">
            <div class="section-indicator questions-indicator"></div>
            <label class="section-label">Number of Questions</label>
          </div>
          <div class="range-inputs">
            <div class="range-group">
              <label class="range-label">MIN</label>
              <input type="number"
                     [(ngModel)]="advancedSearchFilters.minPrice"
                     placeholder="0"
                     class="range-input">
            </div>
            <div class="range-separator">-</div>
            <div class="range-group">
              <label class="range-label">MAX</label>
              <input type="number"
                     [(ngModel)]="advancedSearchFilters.maxPrice"
                     placeholder="100"
                     class="range-input">
            </div>
          </div>
        </div>

        <!-- Duration -->
        <div class="filter-section">
          <div class="section-header">
            <div class="section-indicator duration-indicator"></div>
            <label class="section-label">Duration (minutes)</label>
          </div>
          <div class="range-inputs">
            <div class="range-group">
              <label class="range-label">MIN</label>
              <input type="number"
                     [(ngModel)]="advancedSearchFilters.minPrice"
                     placeholder="0"
                     class="range-input">
            </div>
            <div class="range-separator">-</div>
            <div class="range-group">
              <label class="range-label">MAX</label>
              <input type="number"
                     [(ngModel)]="advancedSearchFilters.maxPrice"
                     placeholder="180"
                     class="range-input">
            </div>
          </div>
        </div>

        <!-- Creation Date -->
        <div class="filter-section">
          <div class="section-header">
            <div class="section-indicator date-indicator"></div>
            <label class="section-label">Creation Date</label>
          </div>
          <div class="date-inputs">
            <div class="date-group">
              <label class="date-label">FROM</label>
              <input type="date"
                     [(ngModel)]="advancedSearchFilters.dateRange"
                     class="date-input">
            </div>
            <div class="date-group">
              <label class="date-label">TO</label>
              <input type="date"
                     [(ngModel)]="advancedSearchFilters.dateRange"
                     class="date-input">
            </div>
          </div>
        </div>

        <!-- Active Filters Display -->
        <div class="active-filters" *ngIf="getActiveFiltersCount() > 0">
          <h4>Active Filters ({{getActiveFiltersCount()}})</h4>
          <div class="filter-tags">
            <span class="filter-tag" *ngIf="advancedSearchFilters.searchTerm">
              Search: "{{advancedSearchFilters.searchTerm}}"
              <i class="fas fa-times" (click)="advancedSearchFilters.searchTerm = ''"></i>
            </span>
            <span class="filter-tag" *ngIf="advancedSearchFilters.topicId">
              Topic: {{getTopicName(advancedSearchFilters.topicId)}}
              <i class="fas fa-times" (click)="advancedSearchFilters.topicId = ''"></i>
            </span>
            <span class="filter-tag" *ngIf="advancedSearchFilters.stageId">
              Stage: {{getStageName(advancedSearchFilters.stageId)}}
              <i class="fas fa-times" (click)="advancedSearchFilters.stageId = ''"></i>
            </span>
            <span class="filter-tag" *ngIf="advancedSearchFilters.courseType !== ''">
              Type: {{advancedSearchFilters.courseType === '0' ? 'Easy' : advancedSearchFilters.courseType === '1' ? 'Medium' : 'Hard'}}
              <i class="fas fa-times" (click)="advancedSearchFilters.courseType = ''"></i>
            </span>
            <span class="filter-tag" *ngIf="advancedSearchFilters.minPrice || advancedSearchFilters.maxPrice">
              Range: {{advancedSearchFilters.minPrice || 0}} - {{advancedSearchFilters.maxPrice || '∞'}}
              <i class="fas fa-times" (click)="clearPriceRange()"></i>
            </span>
            <span class="filter-tag" *ngIf="advancedSearchFilters.dateRange">
              Date: {{formatDateRange()}}
              <i class="fas fa-times" (click)="advancedSearchFilters.dateRange = null"></i>
            </span>
          </div>
        </div>
      </div>

      <div class="popup-footer">
        <button class="btn-clear" (click)="clearAllFilters()">
          <i class="fas fa-undo"></i>
          Clear All
        </button>
        <button class="btn-apply" (click)="applyAdvancedSearch()">
          <i class="fas fa-check"></i>
          Apply Filters
        </button>
      </div>
    </div>
  </div>